<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ø±Ø³Ø´Ù†Ø§Ù…Ù‡ Ù¾Ø²Ø´Ú©ÛŒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'IRANSans', Tahoma, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height:100vh; padding:20px; direction:rtl; }
        .container { max-width:1100px;margin:0 auto;background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align:center; }
        .form-container { padding: 20px; }
        .section { margin-bottom:15px;padding:15px;background:#f9f9f9;border-radius:10px; }
        .question-label { display:block;margin-bottom:8px;font-weight:600; }
        input, select, textarea { width:100%;padding:10px;border:2px solid #ddd;border-radius:8px;margin-bottom:10px }
        .actions { padding:20px; display:flex; gap:10px; }
        .btn { padding:12px 18px;border-radius:8px;border:none; cursor:pointer }
        #loginOverlay { position:fixed; inset:0; background:rgba(0,0,0,0.95); display:flex; align-items:center; justify-content:center; z-index:2000; }
        #loginOverlay .box { background:white;padding:24px;border-radius:12px;min-width:320px;direction:rtl;text-align:right; }
    </style>
</head>
<body>
    <div id="loginOverlay">
        <div class="box">
            <h3 style="margin-bottom:10px;">ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
            <p style="font-size:0.9em;color:#555;margin-bottom:12px;">Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</p>
            <input id="loginUser" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" style="width:100%;padding:10px;margin-bottom:8px;border:1px solid #ddd;border-radius:6px;">
            <input id="loginPass" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" style="width:100%;padding:10px;margin-bottom:8px;border:1px solid #ddd;border-radius:6px;">
            <div style="display:flex;gap:8px;justify-content:flex-end;">
                <button id="loginBtn" style="background:#2196f3;color:white;padding:8px 14px;border:none;border-radius:6px;">ÙˆØ±ÙˆØ¯</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ Ù¾Ø±Ø³Ø´Ù†Ø§Ù…Ù‡ Ù¾Ø²Ø´Ú©ÛŒ</h1>
            <p class="header-subtitle">Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª</p>
        </div>

        <div class="form-container">
            <div class="section">
                <label class="question-label">Ù…Ø±Ú©Ø² Ø¨Ø§Ù„ÛŒÙ†ÛŒ</label>
                <div style="display:flex;gap:8px;align-items:center;">
                    <select id="centerSelect" style="flex:1;padding:10px;border-radius:8px;border:2px solid #ddd;"></select>
                    <input id="newCenterInput" placeholder="Ù…Ø±Ú©Ø² Ø¬Ø¯ÛŒØ¯" style="padding:10px;border-radius:8px;border:2px solid #ddd;min-width:160px;">
                    <button id="addCenterBtn" class="btn" style="background:#4caf50;color:white;">Ø§ÙØ²ÙˆØ¯Ù†</button>
                </div>
            </div>

            <!-- Inserted questionnaire fields (first sections) -->
            <!-- Section 0: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ -->
            <div class="section">
                <h2 style="margin-bottom:10px">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ</h2>
                <label class="question-label">Ú©Ø¯ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ</label>
                <input type="text" id="q0_code" placeholder="Ú©Ø¯ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" required>
                <label class="question-label">Ø³Ù†</label>
                <input type="number" id="q0_age" min="1" max="120" placeholder="Ø³Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" required>
            </div>

            <!-- (rest of questionnaire omitted for brevity in UI; original full questionnaire will be stored similarly) -->

            <div class="actions">
                <button id="submitBtn" class="btn" style="background:#4caf50;color:white;">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø¹Ø¯ÛŒ</button>
                <a href="index.html" class="btn" style="background:#e0e0e0;color:#333;padding:12px 18px;border-radius:8px;text-decoration:none;display:inline-flex;align-items:center;">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            </div>
        </div>
    </div>

    <script>
        // Simple login (no default credentials shown in UI)
        const DEFAULT_USER = 'draghajanidelavar';
        const DEFAULT_PASS = 'admin';
        function showLoginOverlay(show) { document.getElementById('loginOverlay').style.display = show ? 'flex' : 'none'; }
        function doLogin() {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value;
            if (user === DEFAULT_USER && pass === DEFAULT_PASS) {
                sessionStorage.setItem('loggedIn_secondary', '1');
                showLoginOverlay(false);
            } else {
                alert('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
            }
        }
        document.getElementById('loginBtn').addEventListener('click', doLogin);

        // Center management
        function loadCenters() {
            const raw = localStorage.getItem('clinical_centers');
            let centers = [];
            if (raw) {
                try { centers = JSON.parse(raw); } catch (e) { centers = []; }
            }
            if (!centers || centers.length === 0) {
                centers = ['Ù…Ø±Ú©Ø² Ø§Ù…ÛŒØ±Ú©Ù„Ø§', 'Ù…Ø±Ú©Ø² Ø§Ù…Ø§Ù… Ø³Ø§Ø±ÛŒ'];
                localStorage.setItem('clinical_centers', JSON.stringify(centers));
            }
            return centers;
        }
        function renderCenterOptions() {
            const sel = document.getElementById('centerSelect'); sel.innerHTML = '';
            loadCenters().forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; sel.appendChild(o); });
            const saved = localStorage.getItem('selected_center'); if (saved) sel.value = saved;
        }
        document.getElementById('addCenterBtn').addEventListener('click', function(){ const v = document.getElementById('newCenterInput').value.trim(); if (!v) return alert('Ù†Ø§Ù… Ù…Ø±Ú©Ø² Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); const centers = loadCenters(); if (!centers.includes(v)) { centers.push(v); localStorage.setItem('clinical_centers', JSON.stringify(centers)); } document.getElementById('newCenterInput').value=''; renderCenterOptions(); });
        document.getElementById('centerSelect').addEventListener('change', function(){ localStorage.setItem('selected_center', this.value); });

        // Storage keys for secondary questionnaire
        const STORAGE_KEY = 'medical_form_records_secondary';
        const STORAGE_ID_KEY = 'medical_form_id_secondary';

        let allRecords = [];
        let currentRecordId = 1;

        function loadFromStorage() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                allRecords = JSON.parse(stored);
                currentRecordId = parseInt(localStorage.getItem(STORAGE_ID_KEY)) || (allRecords.length + 1);
                updateUI();
            }
        }

        function updateUI() {
            const rc = document.getElementById('recordCount'); if (rc) rc.textContent = allRecords.length;
            const cur = document.getElementById('currentRecordId'); if (cur) cur.textContent = currentRecordId;
        }

        document.getElementById('submitBtn').addEventListener('click', () => {
            const code = document.getElementById('q0_code').value.trim() || '-';
            const age = document.getElementById('q0_age').value || '-';
            const center = document.getElementById('centerSelect').value || '-';

            const record = { ID: currentRecordId, timestamp: new Date().toLocaleString('fa-IR'), code, age, center };
            allRecords.push(record);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allRecords));
            localStorage.setItem(STORAGE_ID_KEY, currentRecordId + 1);
            currentRecordId++;
            updateUI();
            alert('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
            document.getElementById('q0_code').focus();
            document.getElementById('q0_code').value = '';
            document.getElementById('q0_age').value = '';
        });

        window.addEventListener('DOMContentLoaded', () => {
            renderCenterOptions();
            loadFromStorage();
            const loggedIn = sessionStorage.getItem('loggedIn_secondary'); if (!loggedIn) showLoginOverlay(true); else showLoginOverlay(false);
        });
    </script>
</body>
</html>
